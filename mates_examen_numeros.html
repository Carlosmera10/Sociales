<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen: Los N√∫meros (Corregido)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --background-color: #e9ecef;
            --text-color: #212529;
            --border-radius: 12px;
            --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background-color: #fff;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), #0056b3);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 700;
        }

        .header p {
            margin: 5px 0 0;
            font-size: 1.2em;
        }

        .content {
            padding: 30px;
        }

        .question-section {
            margin-bottom: 40px;
            border-left: 4px solid var(--primary-color);
            padding-left: 20px;
        }
        
        .question-section h2 {
            font-size: 1.8em;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .question {
            background-color: var(--light-color);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: var(--border-radius);
            border: 1px solid #dee2e6;
        }

        .question-text {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .options .option {
            display: block;
            background-color: #fff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
        }
        
        .options .option:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .options .option.selected {
            background-color: #cce5ff;
            border-color: var(--primary-color);
            font-weight: 600;
        }
        
        /* Drag and Drop Styles */
        .word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            justify-content: center;
        }

        .word, .match-item {
            padding: 10px 20px;
            background-color: #fff;
            border: 2px solid #ced4da;
            border-radius: 20px;
            cursor: grab;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .word:active {
            cursor: grabbing;
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .drop-zone {
            min-height: 50px;
            border: 2px dashed #adb5bd;
            border-radius: var(--border-radius);
            padding: 10px;
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .drop-zone.over {
            background-color: #d4edda;
        }

        .drop-zone .word {
            cursor: default;
        }
        
        /* Matching Styles */
        .matching-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }
        .column {
            width: 48%;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .match-item {
            cursor: pointer;
        }
        .match-item.selected {
            background-color: #cce5ff;
            border-color: var(--primary-color);
        }
        .match-item.paired {
            background-color: #e2e3e5;
            border-color: #adb5bd;
            cursor: default;
            opacity: 0.7;
        }
        .match-item.correct {
            border-color: var(--success-color) !important;
        }
        .match-item.incorrect {
            border-color: var(--danger-color) !important;
        }
        
        /* Numeric Input */
        .numeric-input {
            width: 150px;
            padding: 10px;
            font-size: 1.2em;
            border: 2px solid #ced4da;
            border-radius: 8px;
            text-align: center;
            margin-top: 10px;
            transition: border-color 0.3s;
        }
        .numeric-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* Feedback Styles */
        .correct { background-color: #d4edda !important; border-color: var(--success-color) !important; }
        .incorrect { background-color: #f8d7da !important; border-color: var(--danger-color) !important; }
        .correct-answer-text { 
            color: var(--success-color); 
            font-weight: bold; 
            margin-left: 10px; 
            display: block; 
            margin-top: 10px;
        }
        .unanswered-feedback {
            color: var(--danger-color);
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }

        .submit-btn {
            display: block;
            width: 100%;
            padding: 20px;
            font-size: 1.5em;
            font-weight: 700;
            color: white;
            background: linear-gradient(135deg, var(--success-color), #218838);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        .results {
            margin-top: 30px;
            padding: 30px;
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            text-align: center;
            display: none; /* Hidden by default */
        }
        
        .results h2 {
            font-size: 2em;
            color: var(--dark-color);
        }
        
        .results p {
            font-size: 1.5em;
            font-weight: 600;
        }
        
        .results .score {
            color: var(--primary-color);
        }

        .feedback-message {
            font-size: 1.2em;
            margin-top: 15px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìù Examen: Los N√∫meros</h1>
            <p>¬°Demuestra lo que has aprendido sobre los n√∫meros naturales!</p>
        </div>
        <div class="content">
            <form id="quiz-form">
                
                <!-- SECCI√ìN 1: TEST (UNA RESPUESTA CORRECTA) -->
                <div class="question-section">
                    <h2>ü§î Secci√≥n 1: Test de Elecci√≥n</h2>
                    <p>Elige la √∫nica respuesta correcta para cada pregunta.</p>
                    
                    <div class="question" data-question-id="1">
                        <div class="question-text">1. ¬øC√≥mo se escribe con cifras el n√∫mero "cuatrocientos siete mil doscientos ocho"?</div>
                        <div class="options" data-correct="407.208">
                            <div class="option">470.280</div>
                            <div class="option">407.208</div>
                            <div class="option">47.208</div>
                            <div class="option">400.728</div>
                        </div>
                    </div>

                    <div class="question" data-question-id="2">
                        <!-- PREGUNTA CORREGIDA: Se especifica a qu√© cifra '5' se refiere -->
                        <div class="question-text">2. ¬øQu√© valor tiene la cifra '5' que est√° a la izquierda en el n√∫mero 542.325?</div>
                        <div class="options" data-correct="5 Centenas de Millar (CM)">
                            <div class="option">5 Decenas de Millar (DM)</div>
                            <div class="option">5 Unidades (U)</div>
                            <div class="option">5 Centenas de Millar (CM)</div>
                            <div class="option">5 Centenas (C)</div>
                        </div>
                    </div>

                    <div class="question" data-question-id="3">
                        <div class="question-text">3. ¬øA qu√© equivale 1 Decena de Millar (DM)?</div>
                        <div class="options" data-correct="10.000 Unidades">
                            <div class="option">1.000 Unidades</div>
                            <div class="option">100.000 Unidades</div>
                            <div class="option">100 Unidades</div>
                            <div class="option">10.000 Unidades</div>
                        </div>
                    </div>
                    
                    <div class="question" data-question-id="4">
                        <div class="question-text">4. ¬øQu√© n√∫mero se forma con <code>9 CM + 3 DM + 9 UM + 3 C + 2 D + 3 U</code>?</div>
                        <div class="options" data-correct="939.323">
                            <div class="option">939.323</div>
                            <div class="option">93.932.3</div>
                            <div class="option">903.932</div>
                            <div class="option">9.393.230</div>
                        </div>
                    </div>
                </div>

                <!-- SECCI√ìN 2: VERDADERO O FALSO -->
                <div class="question-section">
                    <h2>‚úÖ/‚ùå Secci√≥n 2: Verdadero o Falso</h2>
                    <p>Indica si las siguientes afirmaciones son verdaderas o falsas.</p>

                    <div class="question" data-question-id="5">
                        <div class="question-text">5. El n√∫mero 34.800 redondeado a la Unidad de Millar (UM) m√°s cercana es 34.000.</div>
                        <div class="options" data-correct="Falso">
                            <div class="option">Verdadero</div>
                            <div class="option">Falso</div>
                        </div>
                    </div>
                    
                    <div class="question" data-question-id="6">
                        <div class="question-text">6. El n√∫mero ordinal 'trig√©simo' corresponde al n√∫mero 30.</div>
                        <div class="options" data-correct="Verdadero">
                            <div class="option">Verdadero</div>
                            <div class="option">Falso</div>
                        </div>
                    </div>
                    
                    <div class="question" data-question-id="7">
                        <div class="question-text">7. El n√∫mero 90.009 es menor que 90.090.</div>
                        <div class="options" data-correct="Verdadero">
                            <div class="option">Verdadero</div>
                            <div class="option">Falso</div>
                        </div>
                    </div>
                    
                    <div class="question" data-question-id="8">
                        <div class="question-text">8. La descomposici√≥n <code>1 DM + 1 U</code> es igual al n√∫mero 10.001.</div>
                        <div class="options" data-correct="Verdadero">
                            <div class="option">Verdadero</div>
                            <div class="option">Falso</div>
                        </div>
                    </div>
                </div>
                
                <!-- SECCI√ìN 3: RESPUESTA NUM√âRICA -->
                <div class="question-section">
                    <h2>üî¢ Secci√≥n 3: Respuesta Num√©rica</h2>
                    <p>Escribe el resultado num√©rico correcto en cada caja.</p>

                    <div class="question" data-question-id="9">
                        <div class="question-text">9. Aproxima el n√∫mero 28.632 a la Unidad de Millar (UM) m√°s cercana.</div>
                        <input type="number" class="numeric-input" data-answer="29000">
                    </div>
                    
                    <div class="question" data-question-id="10">
                        <div class="question-text">10. ¬øCu√°ntas Unidades (U) hay en 3 Centenas de Millar (CM)?</div>
                        <input type="number" class="numeric-input" data-answer="300000">
                    </div>
                    
                    <div class="question" data-question-id="11">
                        <div class="question-text">11. ¬øQu√© n√∫mero corresponde a la descomposici√≥n <code>20.000 + 5.000 + 800 + 5</code>?</div>
                        <input type="number" class="numeric-input" data-answer="25805">
                    </div>
                </div>

                <!-- SECCI√ìN 4: EMPAREJAR COLUMNAS -->
                <div class="question-section">
                    <h2>üîÑ Secci√≥n 4: Emparejar Columnas</h2>
                    <p>Haz clic en un n√∫mero ordinal y luego en su n√∫mero correspondiente para emparejarlos.</p>
                    <div class="question matching-question" data-question-id="12">
                        <div class="question-text">12. Empareja cada n√∫mero ordinal con su cifra. (5 Puntos)</div>
                        <div class="matching-container">
                            <div class="column" id="column-a">
                                <div class="match-item" data-match-id="1">ü•á Primero</div>
                                <div class="match-item" data-match-id="2">ü•à Vig√©simo</div>
                                <div class="match-item" data-match-id="3">ü•â Noveno</div>
                                <div class="match-item" data-match-id="4">üèÖ Decimocuarto</div>
                                <div class="match-item" data-match-id="5">üéñÔ∏è Vig√©simo quinto</div>
                            </div>
                            <div class="column" id="column-b">
                                <!-- Shuffled on load by JS -->
                                <div class="match-item" data-match-id="3">9¬∫</div>
                                <div class="match-item" data-match-id="5">25¬∫</div>
                                <div class="match-item" data-match-id="1">1¬∫</div>
                                <div class="match-item" data-match-id="2">20¬∫</div>
                                <div class="match-item" data-match-id="4">14¬∫</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECCI√ìN 5: RELLENAR HUECOS (TIPO TEST) -->
                <div class="question-section">
                    <h2>‚úçÔ∏è Secci√≥n 5: Rellenar Huecos</h2>
                    <p>Elige la opci√≥n correcta para completar cada frase.</p>
                    
                    <div class="question" data-question-id="13">
                        <div class="question-text">13. El n√∫mero 365.672 tiene ____ Centenas de Millar.</div>
                        <div class="options" data-correct="3">
                            <div class="option">6</div>
                            <div class="option">5</div>
                            <div class="option">3</div>
                        </div>
                    </div>
                    
                    <div class="question" data-question-id="14">
                        <div class="question-text">14. En el n√∫mero 21.643, la cifra '6' ocupa la posici√≥n de las ____.</div>
                        <div class="options" data-correct="Centenas (C)">
                            <div class="option">Decenas (D)</div>
                            <div class="option">Centenas (C)</div>
                            <div class="option">Unidades de Millar (UM)</div>
                        </div>
                    </div>
                    
                    <div class="question" data-question-id="15">
                        <div class="question-text">15. Una Centena de Millar (CM) equivale a ____ Unidades de Millar (UM).</div>
                        <div class="options" data-correct="100">
                            <div class="option">10</div>
                            <div class="option">1.000</div>
                            <div class="option">100</div>
                        </div>
                    </div>
                </div>

                <!-- SECCI√ìN 6: ELEGIR LA FRASE CORRECTA -->
                <div class="question-section">
                    <h2>üßê Secci√≥n 6: ¬øCu√°l es la correcta?</h2>
                    <p>De las siguientes opciones, elige la que est√° escrita o descompuesta correctamente.</p>
                    
                    <div class="question" data-question-id="16">
                        <div class="question-text">16. Elige la descomposici√≥n <strong>correcta</strong> para el n√∫mero 38.245:</div>
                        <div class="options" data-correct="3 DM + 8 UM + 2 C + 4 D + 5 U">
                            <div class="option">30.000 + 8.000 + 200 + 50 + 4</div>
                            <div class="option">3 DM + 8 UM + 2 C + 4 D + 5 U</div>
                            <div class="option">3 CM + 8 DM + 2 C + 4 D + 5 U</div>
                        </div>
                    </div>
                    
                    <div class="question" data-question-id="17">
                        <div class="question-text">17. Elige el n√∫mero escrito <strong>correctamente</strong>:</div>
                        <div class="options" data-correct="Veinti√∫n mil seiscientos cuarenta y tres">
                            <div class="option">Veintiun mil seiscientos cuarenta y tres</div>
                            <div class="option">Veinti√∫n mil seiscientos cuarenta y tres</div>
                            <div class="option">Veintiuno mil seiscientos cuarenta y tres</div>
                        </div>
                    </div>
                    
                    <div class="question" data-question-id="18">
                        <div class="question-text">18. Elige la comparaci√≥n <strong>incorrecta</strong>:</div>
                        <div class="options" data-correct="10.001 = 1.010">
                            <div class="option">90.000 < 90.009</div>
                            <div class="option">23.456 < 32.456</div>
                            <div class="option">10.001 = 1.010</div>
                        </div>
                    </div>
                </div>
                
                <!-- SECCI√ìN 7: ORDENAR PASOS -->
                <div class="question-section">
                    <h2>üìä Secci√≥n 7: Ordenar N√∫meros</h2>
                    <p>Arrastra los n√∫meros al recuadro para ordenarlos de <strong>menor a mayor</strong>.</p>
                    <div class="question" data-question-id="19">
                        <div class="question-text">19. Ordena los siguientes n√∫meros de MENOR a MAYOR. (4 Puntos)</div>
                        <div class="drop-zone" data-answer="43.056 60.000 78.987 94.324"></div>
                        <div class="word-bank">
                            <!-- Shuffled on load by JS -->
                            <div class="word" draggable="true">60.000</div>
                            <div class="word" draggable="true">94.324</div>
                            <div class="word" draggable="true">43.056</div>
                            <div class="word" draggable="true">78.987</div>
                        </div>
                    </div>
                </div>

                 <!-- SECCI√ìN 8: TEST M√öLTIPLE RESPUESTA -->
                <div class="question-section">
                    <h2>ü§î Secci√≥n 8: Test de M√∫ltiples Respuestas</h2>
                    <p>Elige <strong>todas</strong> las respuestas correctas para cada pregunta.</p>
                    
                    <div class="question" data-question-id="20">
                        <div class="question-text">20. ¬øCu√°les de las siguientes descomposiciones son correctas para el n√∫mero 435.900? (2 Puntos)</div>
                        <div class="options multiple-choice" data-correct='["4 CM + 3 DM + 5 UM + 9 C", "400.000 + 30.000 + 5.000 + 900"]'>
                            <div class="option">4 CM + 3 DM + 5 UM + 9 C</div>
                            <div class="option">400.000 + 30.000 + 5.000 + 900</div>
                            <div class="option">4 DM + 3 UM + 5 C + 9 D</div>
                            <div class="option">40.000 + 3.000 + 500 + 90</div>
                        </div>
                    </div>
                </div>
            </form>
            <button type="submit" form="quiz-form" class="submit-btn">¬°Terminar y Corregir!</button>
            <div class="results" id="results-container">
                <h2>Resultados del Examen</h2>
                <p>Tu puntuaci√≥n es: <span id="score" class="score">0</span> / <span id="total-points">28</span></p>
                <p>Nota final: <span id="final-grade" class="score">0</span> / 10</p>
                <p id="feedback-message" class="feedback-message"></p>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('quiz-form');
        const resultsContainer = document.getElementById('results-container');
        const scoreElement = document.getElementById('score');
        const totalPointsElement = document.getElementById('total-points');
        const finalGradeElement = document.getElementById('final-grade');
        const feedbackMessageElement = document.getElementById('feedback-message');
        
        const TOTAL_POINTS = 28; // Puntos totales posibles
        totalPointsElement.textContent = TOTAL_POINTS;
        
        // --- General Interaction Logic ---
        
        // Logic for single and multiple choice questions
        const optionContainers = document.querySelectorAll('.options');
        optionContainers.forEach(container => {
            container.addEventListener('click', function (e) {
                if (e.target.classList.contains('option')) {
                    const isMultipleChoice = container.classList.contains('multiple-choice');
                    if (isMultipleChoice) {
                        e.target.classList.toggle('selected');
                    } else {
                        // Deselect other options in the same question
                        container.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
                        e.target.classList.add('selected');
                    }
                }
            });
        });

        // --- Drag and Drop Logic ---
        let draggedItem = null;
        const draggables = document.querySelectorAll('.word');
        const dropZones = document.querySelectorAll('.drop-zone');

        draggables.forEach(draggable => {
            draggable.addEventListener('dragstart', function () {
                draggedItem = this;
                setTimeout(() => this.style.display = 'none', 0);
            });

            draggable.addEventListener('dragend', function () {
                setTimeout(() => {
                    if (draggedItem) { // Check if draggedItem is not null
                       draggedItem.style.display = 'inline-flex';
                    }
                    draggedItem = null;
                }, 0);
            });
        });

        dropZones.forEach(zone => {
            zone.addEventListener('dragover', function (e) {
                e.preventDefault();
                this.classList.add('over');
            });

            zone.addEventListener('dragleave', function () {
                this.classList.remove('over');
            });

            zone.addEventListener('drop', function (e) {
                e.preventDefault();
                this.classList.remove('over');
                if (draggedItem) {
                    this.appendChild(draggedItem);
                }
            });
        });
        
        // --- Matching Logic ---
        const matchingQuestions = document.querySelectorAll('.matching-question');
        matchingQuestions.forEach(question => {
            let selectedItem = null;
            const columns = question.querySelectorAll('.column');
            
            columns.forEach(column => {
                column.addEventListener('click', (e) => {
                    const target = e.target;
                    if (!target.classList.contains('match-item') || target.classList.contains('paired')) {
                        return;
                    }

                    // If an item is selected and the new target is in a different column
                    if (selectedItem && selectedItem.parentElement !== target.parentElement) {
                        target.classList.add('paired');
                        selectedItem.classList.add('paired');
                        
                        // Store the paired ID for checking answers
                        const id1 = selectedItem.dataset.matchId;
                        const id2 = target.dataset.matchId;
                        selectedItem.dataset.pairedWith = id2;
                        target.dataset.pairedWith = id1;

                        selectedItem.classList.remove('selected');
                        selectedItem = null;

                    } else { // If no item is selected or clicking in the same column
                        // Deselect all in the same column and select the new target
                        target.parentElement.querySelectorAll('.match-item').forEach(item => item.classList.remove('selected'));
                        target.classList.add('selected');
                        selectedItem = target;
                    }
                });
            });
        });

        // --- Shuffle Elements on Load ---
        function shuffleChildren(parent) {
            let children = Array.from(parent.children);
            parent.innerHTML = '';
            while (children.length > 0) {
                parent.appendChild(children.splice(Math.floor(Math.random() * children.length), 1)[0]);
            }
        }
        
        // Shuffle options for questions, words for drag-drop, and the second column for matching
        document.querySelectorAll('.options, .word-bank, #column-b').forEach(el => {
            shuffleChildren(el);
        });


        // --- Form Submission and Correction ---
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            const { score } = calculateScore();
            displayResults(score);
            highlightAnswers();
            // Scroll to the results section for better UX
            resultsContainer.scrollIntoView({ behavior: 'smooth' });
        });

        function calculateScore() {
            let score = 0;
            
            // Sections 1, 2, 5, 6: Single Choice Questions (1 point each)
            document.querySelectorAll('.question .options:not(.multiple-choice)').forEach(q => {
                const selected = q.querySelector('.option.selected');
                if (selected && selected.textContent.trim() === q.dataset.correct.trim()) {
                    score++;
                }
            });
            
            // Section 8: Multiple Choice Question (1 point per correct choice, all must be correct)
            document.querySelectorAll('.question .options.multiple-choice').forEach(q => {
                const selectedOptions = Array.from(q.querySelectorAll('.option.selected')).map(opt => opt.textContent.trim());
                const correctOptions = JSON.parse(q.dataset.correct);
                
                selectedOptions.sort();
                correctOptions.sort();
                
                const isCorrect = selectedOptions.length === correctOptions.length && selectedOptions.every((value, index) => value === correctOptions[index]);
                
                if (isCorrect) {
                    score += correctOptions.length; // Add points for this question
                }
            });

            // Section 3: Numeric Input (1 point each)
            document.querySelectorAll('.numeric-input').forEach(input => {
                if (input.value.trim() === input.dataset.answer) {
                    score++;
                }
            });
            
            // Section 4: Matching (1 point per correct pair)
            // CORRECCI√ìN: Se itera solo sobre una columna para evitar contar los puntos dos veces.
            document.querySelectorAll('#column-a .match-item').forEach(item => {
                if (item.dataset.pairedWith && item.dataset.matchId === item.dataset.pairedWith) {
                    score++;
                }
            });

            // Section 7: Order Process (4 points for correct order)
            document.querySelectorAll('.question .drop-zone[data-answer]').forEach(zone => {
                const words = Array.from(zone.querySelectorAll('.word')).map(w => w.textContent.trim()).join(' ');
                if (words === zone.dataset.answer) {
                    score += 4; // 4 points for this question
                }
            });

            return { score };
        }

        function displayResults(score) {
            const finalGrade = ((score / TOTAL_POINTS) * 10).toFixed(1);
            scoreElement.textContent = score;
            finalGradeElement.textContent = finalGrade;

            let message = '';
            let emoji = '';
            if (finalGrade >= 9) {
                message = "¬°Excelente! ¬°Eres un genio de los n√∫meros!";
                emoji = 'üèÜ';
            } else if (finalGrade >= 7) {
                message = "¬°Muy bien! Sigue as√≠ y ser√°s imparable.";
                emoji = 'üéâ';
            } else if (finalGrade >= 5) {
                message = "¬°Aprobado! Buen trabajo, pero puedes mejorar.";
                emoji = 'üëç';
            } else {
                // CORRECCI√ìN: Emoji m√°s amigable
                message = "Necesitas repasar un poco m√°s. ¬°No te rindas!";
                emoji = 'üìö';
            }
            feedbackMessageElement.textContent = emoji + ' ' + message;
            resultsContainer.style.display = 'block';
        }

        function highlightAnswers() {
            // Clean previous feedback
            document.querySelectorAll('.correct, .incorrect, .correct-answer-text, .unanswered-feedback').forEach(el => {
                el.classList.remove('correct', 'incorrect');
                if (el.matches('.correct-answer-text, .unanswered-feedback')) el.remove();
            });

            // Single Choice
            document.querySelectorAll('.question .options:not(.multiple-choice)').forEach(q => {
                const selected = q.querySelector('.option.selected');
                const correctAnswer = q.dataset.correct.trim();
                if (selected) {
                    if (selected.textContent.trim() === correctAnswer) {
                        selected.classList.add('correct');
                    } else {
                        selected.classList.add('incorrect');
                        const feedback = document.createElement('span');
                        feedback.className = 'correct-answer-text';
                        feedback.textContent = `‚úîÔ∏è La respuesta correcta era: ${correctAnswer}`;
                        q.appendChild(feedback);
                    }
                } else {
                    // CORRECCI√ìN: Feedback para preguntas no respondidas
                    const feedback = document.createElement('span');
                    feedback.className = 'unanswered-feedback';
                    feedback.textContent = `‚ùå No has respondido. La respuesta correcta era: ${correctAnswer}`;
                    q.appendChild(feedback);
                }
            });

            // Multiple Choice
            document.querySelectorAll('.question .options.multiple-choice').forEach(q => {
                 const selectedOptions = q.querySelectorAll('.option.selected');
                 const correctOptionsTexts = JSON.parse(q.dataset.correct);
                 
                 q.querySelectorAll('.option').forEach(opt => {
                     if (correctOptionsTexts.includes(opt.textContent.trim())) {
                         if(opt.classList.contains('selected')) {
                             opt.classList.add('correct');
                         } else {
                            // Optionally highlight correct answers that were not selected
                         }
                     } else if (opt.classList.contains('selected')) {
                         opt.classList.add('incorrect');
                     }
                 });
            });

            // Numeric Input
            document.querySelectorAll('.numeric-input').forEach(input => {
                if (input.value.trim() === input.dataset.answer) {
                    input.classList.add('correct');
                } else {
                    input.classList.add('incorrect');
                    const feedback = document.createElement('span');
                    feedback.className = 'correct-answer-text';
                    feedback.textContent = `‚úîÔ∏è Correcto: ${input.dataset.answer}`;
                    input.parentElement.appendChild(feedback);
                }
            });
            
            // Matching
            document.querySelectorAll('#column-a .match-item').forEach(item => {
                const isPaired = item.dataset.pairedWith !== undefined;
                const isCorrect = isPaired && item.dataset.matchId === item.dataset.pairedWith;
                if (isPaired) {
                    const pairedItem = document.querySelector(`#column-b .match-item[data-match-id='${item.dataset.pairedWith}']`);
                    if(isCorrect) {
                        item.classList.add('correct');
                        if(pairedItem) pairedItem.classList.add('correct');
                    } else {
                        item.classList.add('incorrect');
                        if(pairedItem) pairedItem.classList.add('incorrect');
                    }
                }
            });

            // Order Process
            document.querySelectorAll('.question .drop-zone[data-answer]').forEach(zone => {
                const answer = Array.from(zone.querySelectorAll('.word')).map(w => w.textContent.trim()).join(' ');
                if (answer === zone.dataset.answer) {
                    zone.classList.add('correct');
                } else {
                    zone.classList.add('incorrect');
                     const feedback = document.createElement('span');
                    feedback.className = 'correct-answer-text';
                    feedback.textContent = `‚úîÔ∏è El orden correcto era: ${zone.dataset.answer}`;
                    zone.parentElement.appendChild(feedback);
                }
            });
        }
    });
    </script>
</body>
</html>
